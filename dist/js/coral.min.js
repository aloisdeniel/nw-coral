/*! 
    nw-coral
    Version : 0.1.0
    Date : 2015-01-02
    License : MIT
*/
var gui=require("nw.gui"),win=gui.Window.get(),body=$(document.body),createTitleBar=function(a){var b=$("<div />",{id:"window-title"}),c=$("<div />",{"class":"options"}),d=$("<a />",{"class":"close",href:"#"}).append($("<i />",{"class":"ion-close-round"}));c.append(d);var e=$("<a />",{"class":"maximize",href:"#"}).append($("<i />",{"class":"ion-arrow-resize"}));c.append(e);var f=$("<a />",{"class":"minimize",href:"#"}).append($("<i />",{"class":"ion-minus-round"}));c.append(f),b.append(c);var g=$("<img />",{"class":"logo"});b.append(g);var h=$("<h1 />");return b.append(h),body.append(b),d.on("click",function(){a.close(),gui.App.quit()}),e.on("click",function(){screen.availHeight<=win.height?a.unmaximize():a.maximize()}),f.on("click",function(){a.minimize()}),{root:b,children:{title:h,icon:g}}},createHeaderBar=function(a){var b=$("<div />",{id:"window-header"}),c=$("<a />",{"class":"menu ion-navicon-round",href:"#"});b.append(c);var d=$("<div />",{"class":"actions"});return b.append(d),body.append(b),c.on("click",function(){var b=c.offset();a.menu.popup(b.left,b.top+25)}),{root:b,children:{menu:c,actions:d}}},createNavigationBar=function(){var a=$("#window-content .tab");if(!a.length)return $("#window-content").addClass("tab"),null;$("#window-content").addClass("with-tabs");var b=$("<div />",{id:"window-navigation"}),c=[];return a.each(function(){var a=$("<a />",{href:"#"}),d=$("<i />",{"class":$(this).attr("icon")}),e=$("<b />");e.hide(),a.append(d);var f=$("<span />");f.text($(this).attr("title")),a.append(f),a.append(e),b.append(a),c.push({button:a,notifications:e,content:$(this)})}),body.append(b),{root:b,children:{tabs:c}}},createLoadingLayer=function(){var a=$("<div />",{id:"window-layer","class":"animated fadingOut"});a.hide();var b=$("<div />",{"class":"indicator"});a.append(b),b.append($("<div />",{"class":"spinner"}).append($("<div />",{"class":"bounce1"})).append($("<div />",{"class":"bounce2"})).append($("<div />",{"class":"bounce3"})));var c=$("<h2 />");return b.append(c),body.append(a),{root:a,children:{message:c}}},createFooterBar=function(){var a=$("<div />",{id:"window-footer"}),b=$("<i />");a.append(b);var c=$("<h2 />");return a.append(c),body.append(a),{root:a,children:{icon:b,message:c}}},createPopup=function(){if(!$("#window-popups").length)return null;var a=$("#window-popups"),b=$("<div />",{id:"window-popups-title"}),c=$("<div />",{"class":"options"}),d=$("<a />",{"class":"close",href:"#"}).append($("<i />",{"class":"ion-close-round"}));c.append(d),b.append(c);var e=$("<h1 />");return b.append(e),a.append(b),d.on("click",function(){a.removeClass("visible"),$("#window-popups .popup").each(function(){$(this).hide()}),b.hide()}),{root:a,children:{title:e,bar:b}}},Coral=function(a){if(body.addClass("darwin"===process.platform?"mac":"windows"),this.titlebar=createTitleBar(win),this.headerbar=createHeaderBar(a),this.loadinglayer=createLoadingLayer(),this.footerbar=createFooterBar(),this.navigationbar=createNavigationBar(),this.popup=createPopup(),null!==this.navigationbar){var b=this;this.navigationbar.children.tabs.forEach(function(a,c){a.button.on("click",c,function(a){b.selectTab(a.data)})})}this.setTitle($(document).attr("title")),this.setIcon(a.icon),this.selectTab(0)};Coral.prototype.setTitle=function(a){this.titlebar.children.title.text(a)},Coral.prototype.setIcon=function(a){this.titlebar.children.icon.attr("src",a)},Coral.prototype.setStatus=function(a,b){this.footerbar.children.message.text(b),this.footerbar.children.icon.attr("class",a)},Coral.prototype.setActionBar=function(a){var b=this.headerbar.children.actions;b.empty(),a.forEach(function(a){var c=$("<a />",{href:"#"});c.addClass("animated"),c.addClass("fadeIn"),c.addClass(a.icon),c.on("click",a.action),b.append(c)})},Coral.prototype.selectTab=function(a){null!==this.navigationbar&&this.navigationbar.children.tabs.forEach(function(b,c){a===c?(b.content.removeClass("hidden"),b.button.addClass("selected")):(b.content.addClass("hidden"),b.button.removeClass("selected"))})},Coral.prototype.updateTabNotifications=function(a,b){if(null!==this.navigationbar){var c=this.navigationbar.children.tabs[a];b?(c.notifications.text(b),c.notifications.show()):c.notifications.hide()}},Coral.prototype.showPopup=function(a){var b=$("#"+a);this.popup.children.title.text(b.attr("title")),this.popup.children.bar.show(),this.popup.root.addClass("visible"),b.show()},Coral.prototype.closePopup=function(){this.popup.root.removeClass("visible"),this.popup.children.bar.hide(),$("#window-popups .popup").each(function(){$(this).hide()})},Coral.prototype.showLoading=function(a){this.loadinglayer.children.message.text(a),this.loadinglayer.root.show()},Coral.prototype.hideLoading=function(){this.loadinglayer.root.hide()};